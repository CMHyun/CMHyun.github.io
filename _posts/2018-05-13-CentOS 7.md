---
layout: post
title:  "CentOS 7 Apache Setting"
tags:
  - centos7
  - apache
hero: https://github.com/CMHyun/CMHyun.github.io/blob/master/assets/post_img/AutumnCapital.jpg
overlay: red
published: true

---

# CentOS 7 - Setting up Web Project

## 	Table of Contents

#### 		1. Install CentOS 7 using a virtual machine(Virtual Box)

#### 		2. Setting up network and other options

#### 		3. Installing a package

#### 		4. Setting up the Apache Server(Httpd)

#### 		5. Setting up the Java(JRE or JDK)

#### 		6. Setting up the Tomcat

#### 		7. Setting up the Virtual Host(Apache vhost)

#### 		8. Connecting Apache Server with Tomcat

#### 		9. Setting up the MySQL

#### 		10.  Connecting Tomcat with MySQL

#### 		11. Web Project

#### 		12. Phabricator

#### 		13. Etc



### ※ This document is constantly being update.

이 문서는 계속해서 업데이트 되어가고 있습니다. 처음 시작과 달리 수정해야 될 내용이 있다면 수정할 것이고 불필요한 부분이 존재한다면 지워질 수 있습니다. 댓글로 질문을 올려주신다면 제가 아는 선에서 최대한 답변을 드리겠습니다.



### <u>※ The copyright of this document resides in the author CMHyun.</u>

이 문서는 저작권의 보호를 받습니다. 이 글을 퍼가시거나 사진을 가져다 쓰실 경우 댓글로 미리 알려주시고 게시물에 출처를 꼭 남겨주시기 바랍니다.



### 1. Install CentOS 7 using a virtual machine(Virtual Box)

이번 시간에는 CentOS 7을 가상머신을 통해 설치하고 Web Server, WAS, Java, Database(MySQL)를 설치 및 설정과 연동을 하는 글을 작성해봅니다.  CentOS를 설치하는 Edition은 여러가지가 있습니다만, 그 중 저는 **Minimal**을 기준으로 설치를 하겠습니다. 제가 Minimal로 설치하는 이유는 크게 2가지 입니다. 

첫 째. 패키지 설치를 통해 설정 방법 및 학습 목적을 위해서

둘 째. 최소한의 설치로 불필요한 패키지를 설치하지 않기 위해서

이렇게 두 가지 이유로 인해 이 글에서는 Minimal Edition을 설치합니다. 또한 현재의 글 작성 시점에서는 서버로 이용하기 보단 설치 및 설정 부분의 중점이 있습니다. 이 문서는 추후 서버로 이용될 시 참고용으로 작성되는 것이니 서버의 ip 및 서버이름 등의 설정은 다른 사이트를 통해 해주시면 됩니다. 나중에 혹시라도 서버의 세팅도 필요하다면 호스트네임, 고정 ip 설정, NTP(Network Time Protocol) 시간 동기화, 문자셋 설정 등등을 Etc(목차 추가 링크)를 통해 추가하도록 하겠습니다.



###### CentOS 7 URL: https://www.centos.org/download/



URL을 통해 Minimal Edition을 다운 받습니다.







### 2. Setting up network and other options

저의 처음 설정은 Host 화면과 Guest 화면을 왔다갔다 하는 것이 번거로워 ssh 프로토콜을 이용하여 Putty라는 프로그램을 통해 접속해서 사용하는 방법을 사용하려고 합니다. (번거로운 이유는 Guest화면에서 Host 화면으로 가려면 Host키를 눌러야 Guest를 빠져나와 Host 화면에 마우스를 움직일 수 있습니다. / Host 키 설정은 다른 부분에서 얘기하겠습니다. 또한 Putty에서는 한글입력이 되지만 Guest에서는 따로 문자셋을 추가해줘야 하는 불편함도 있습니다. 어려운 부분은 아니지만 필요 시 문서에 업데이트 할 것입니다.)  Putty를 통해 Host와 Guest를 연결하려면 네트워크를 설정해줘야 하는데,  이 부분에서 Host와 Guest 개념이 등장합니다. 사실 이 앞에서 먼저 등장해야 되는 개념이지만 실질적으로 우리가 제일 먼저 봐야 할 부분은 네트워크겠죠? Host는 가상머신이 아닌 우리의 원래 OS라고 생각하시면 되고 가상머신을 Guest로 생각하시면 편합니다. 

* 자세한 개념은 문서가 조금씩 업데이트 되면서 추가하겠습니다.
* Minimal Edition으로 설치하여 방화벽이 설정되어 있지 않습니다. 
  방화벽 설치 및 포트 허용의 상세한 설정 부분은 패키지 설치 시**(목차 링크 추가)**에 들어가겠습니다.

우선 실행되어 있는 Guest 화면(CentOS 7)에서의 ip를 알아야겠죠?



`ip addr show` 라는 명령어를 입력하면 아래 화면과 같이 명령어를 입력하면 ip를 알 수 있습니다.

(ip 확인하는 명령어 - 사진)



이제 Host의 ip를 알아볼 차례입니다.

Host는 우리가 실질적으로 들어와있는 OS라고 했습니다. 현재 Windows 10을 사용하고 있는 저는 시작 → 실행 → cmd 또는 Win + r → cmd 를 통해 **명령 프롬프트**를 실행하여 ipconfig 라는 명령어를 치게 되면 아래 화면과 같이 ip를 알 수 있습니다. 

(Windows ip 확인 명령어 - 사진)



Virtual Box에서 설치 시 생성한 이더넷 어댑터 VirtualBox Host-Only Network 라는 네트워크 어댑터를 통해 Host와 Guest를 서로 연결할 수 있게 도와줍니다.

* 만약 나는 여러대의 Guest를 사용하고 싶고 Putty (ssh)를 개별적으로 키고 싶다면 Virtual Box에서 환경설정 - Host 어댑터를 추가하시면 됩니다.



이제 Host와 Guest 사이에 네트워크를 연결해줘야 할 차례입니다.

(네트워크 포트 포워딩 - 사진)



이 부분에서 현재 필요한 것은 ssh 프로토콜만 해놓으면 됩니다만 추후 다시 이 설정을 들어갈 필요 없이 미리 포트를 설정해놓겠습니다.



ftp를 사용하신다면 ftp의 Port도 추가하시면 됩니다. ftp의 Default Port는 21번 입니다. 

(Data Transfer Default Port: 20)



Apache Server(httpd)의 Default Port는 80입니다. (왜 Default Port가 80인지는 Apache Server Setting**(목차 링크 추가)** 부분에서 보실 수 있습니다.)



Tomcat의 Default Port는 8080입니다. (왜 Default Port가 80인지는 Tomcat Setting**(목차 링크 추가)** 부분에서 보실 수 있습니다.)



Database인 MySQL과는 직접적으로 들어갈 일은 없기때문에 하지 않으셔도 무방하지만 하실 일이 있다면 Default Port는 3306입니다.



이제 모든 Port를 추가하고 확인을 누르시면 됩니다. 



잘 적용이 되었는지는 Putty를 통해 접속하면 확인할 수 있습니다. 당연히 설치한 Guest(CentOS 7)가 켜져 있어야 접속 할 수 있습니다. 



접속 후 화면 입니다. 이제 Host 키를 누르지 않고 Host화면(제 기준에서는 윈도우 화면)에서 Putty를 통해 CentOS에 접근 할 수 있게 되었습니다.



**접근 후 제일 먼저 해야될 일은 Virtualbox Guest additions 설치입니다.**

이 부분이 왜 중요하냐면 Host와의 공유 폴더 및 각종 설정에 필수적이기 때문에 처음에 설정하고 들어가야 나중에 편합니다.



Putty 화면 또는 Guest(가상머신) 화면에서 `yum update`라는 명렁어를 입력해줍니다.

* yum의 설명은 나중에 추가됩니다.



yum update를 통해 설치되어 있는 패키지들을 최신 버전의 패키지로 업데이트 하게 됩니다. 중간에 업데이트 하겠냐는 물음에는 y를 입력하고 Enter를 눌러주면 됩니다.

(이 부분은 약간의 시간이 걸립니다.)



완료가 되면 `shutdown -r now` 라는 명령어를 통해 재부팅합니다. 



잠깐! Putty 화면에서 입력할 경우 연결이 끊기는 것이 당연합니다. 당황하지 마시고 끊긴 후 Guest(가상머신) 화면을 보시면 재부팅중인 CentOS 7를 보게 되실탠데, 로그인 창이 뜨면 재부팅이 완료된 것이고 Putty 창의 마우스 우측 버튼을 클릭하여 Restart Session을 통해 다시 접속할 수 있습니다. 



다시 로그인 후 이번에는 `yum update kernel`을 입력해줍니다. 



마찬가지로 중간중간 뜨는 물음에는 y를 입력하고 Enter를 눌러주시면 됩니다.



완료가 된 후 또 다시 `shutdown -r now`라는 명령어를 통해 재부팅합니다.

Putty화면을 이용하고 있는 사용자는 아까와 마찬가지로 재접속을 하시면 됩니다.



이제 아래의 명령어를 입력해줍니다.

`yum groupinstall "Development tools"`

`yum install kernel-devel`



설치가 완료 후 이번에는 가상머신 CentOS 화면으로 가야합니다. 가상머신 화면 창의 상단을 보시면 장치 탭이 있습니다. 클릭 후 "게스트 확장 CD 이미지 삽입"을 누르고 



`cd /mnt` 

(home에서 mnt라는 폴더로 접근 합니다.)



`mkdir cdrom && mount /dev/cdrom /mnt/cdrom`

(mnt라는 폴더안에 cdrom이라는 폴더를 생성하고 dev폴더 안에 있는 cdrom 폴더와 마운트(연결) 해줍니다.)



`cd cdrom && ./VBoxLinuxAdditions.run`

(cd 명령어를 통해 cdrom 폴더로 접근하고 ./VBoxLinuxAdditions.run를 실행시킵니다.)



모든것이 완료되면 다시 shutdown -r now 라는 명령어를 통해 재시작 해줍니다.



이제 공유폴더를 설정해볼 시간입니다.



공유폴더는 Host 화면(윈도우)에서 자신이 지정한 폴더를 Geust(CentOS 7)에게 공유할 수 있는 기능입니다. 



Virtual Box의 설정을 통해 아래의 화면과 같이 해줍니다.

폴더명과 위치는 사용자 마음입니다. 저는 알아보기 쉽게 "share_win"이라는 폴더를 생성하여 경로를 추가하였습니다.



공유폴더를 놓고 싶은 위치의 경로로 이동하여 아래의 명령어를 통해 mount 해줍니다.



`mount -t vboxsf share_win share/`

명령어 해석: mount -t vboxsf {설정에서 지정한 공유 폴더 이름} {마운트할 가상 머신의 위치})



이렇게 하면 이제 윈도우에 지정한 폴더가 CentOS 7에서 공유되어 서로 사용할 수 있게 되었습니다. 

* 장점은 윈도우에서 다운받은 파일을 공유폴더에 넣으면 CentOS에서 쉽게 가져다 쓸 수 있습니다.







### 3. Installing a package 

이제 각종 필요한 package를 설치해보도록 하겠습니다. 



* **iptables**

  > CentOS의 방화벽입니다. CentOS7으로 오면서 firewall로 변경되었지만 iptables를 그대로 사용할 수 있습니다. 

* **httpd**

* **apr**

  > 톰캣은 뛰어난 확장성, 성능 및 기본 서버 기술로 더 나은 통합을 제공하기 위해 Apache Portable Runtime를 사용할 수 있습니다. 아파치 포터블 런타임은 아파치 HTTP 서버 2.x.의 핵심이며 휴대용 라이브러리입니다. 이런 APR은 고급 IO 기능(예:sendfile, epoll and OpenSSL 등)에 대한 접근을 포함하여 OS 수준의 기능 (난수 생성, 시스템 상태), 그리고 기본 프로세스 처리(공유 메모리, NT 파이프와 유닉스 소켓) 등 많은 용도로 사용되고 있습니다. 이러한 기능은 일반적인 목적의 웹 서버를 톰캣을 이용하도록 하며, 다른 기본 웹 기술과 훨씬 더 통합을 가능하게 하고, 전반적인 자바가 단순히 백엔드에 주력한 기술보다 전체 본격적인 웹서버 플랫폼으로 훨씬 더 성공할 수 있도록 만들어 줍니다.

* **apr-util**

* **pcre** 

  > pcre라이브러리는 Perl 5 같은 구문과 의미를 사용하여 정규식 패턴 일치를 구현하는 함수의 집합이다. PCRE는 자체 native API 뿐만 아니라 POSIX 정규식 API에 대응하는 래퍼 함수의 집합도 포함하고 있다. PCRE 라이브러리는 심지어 proprietary software 개발에 사용되어도 무료이다. PCRE는 원래 Exim MTA(Exim은 Mail Transfer Agent의 한 종류)를 위해 만들어졌으나, 요즘에는 Apache, PHP, KDE 등을 포함한 유명한 오픈소스 프로젝트에서 사용되고 있다. PCRE는 애플사의 사파리와 같은 몇몇의 잘 알려진 사용 제품에서 그 방법을 찾기도 했다. PCRE를 사용하는 다른 프로젝트는 다음과 같다. Chicken, Ferite, Onyx 등... Perl 5의 사용법(또는 문법)과 유사하게 만들어 졌고, 자제 API도 있고, POSIX와의 호환성도 좋고, 심지어 소유권을 주장할 수 있는 소프트웨어 개발에도 무료로 사용할 수 있고, 원래는 메일 전송 에이전트 용으로 만들었는데 장안의 화제가 되어 주옥같은 오프 소스 프로젝트에서 두루두루 사용되고 있으며, 애플사의 사파리와 같이 엄청 유명한 상용 제품에도 사용되고 있다고 한다

* **tomcat**

* **jre**

* **jdk(option)**

* **MySQL**

* Phabricator

* **Phabricator**



다운로드 방법은 wget를 통한 다운과 윈도우에서 다운받아 공유폴더에 넣어서 이용하는 방법 2가지를 설명합니다. 설치는 rpm(Redhat Package Manager) or yum 방식을 이용해야 하는 필수 패키지가 아니라면 다 각자 개별 설치합니다.



먼저 Apache Server(htppd, apr, apr-util, pcre)를 다운받도록 하겠습니다. 

HTTPD (Apache Server) Download Link: https://httpd.apache.org/download.cgi

APR(Apache Portable Runtime) Download Link: http://apr.apache.org/download.cgi

APR-UTIL(Apache Portable Runtime Utility) Download Link: http://apr.apache.org/download.cgi

PCRE(Perl Compatible Regular Expressions) Download Link: https://ftp.pcre.org/pub/pcre/

Tomcat 8.5.30 Download Link: https://tomcat.apache.org/download-80.cgi

Tomcat Connectors Download Link: https://tomcat.apache.org/download-connectors.cgi

JDK(Java Development Kit) Download Link: http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html

JRE(Java Runtime Environment) Download Link: http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html

MySQL Download Link: https://dev.mysql.com/downloads/mysql/







### 4. Setting up the Apache Server(Httpd)







### 5. Setting up the Java(JRE or JDK)







### 6. Setting up the Tomcat







### 7. Setting up the Virtual Host(Apache vhost)







### 8. Connecting Apache Server with Tomcat







### 9. Setting up the MySQL







### 10.  Connecting Tomcat with MySQL







### 11. Web Project 







### 12. Phabricator







### 13. Etc

##### 	Linux Default Command 

​		d

##### 	Vi(Vim) Default Command 

​		d		

##### 	Hostname

​		To resolve the host name: `echo $HOSTNAME`

​		To rename a host: `vi /etc/hostname`

























